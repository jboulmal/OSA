<html>
	<head>
		<title>OSA default login form</title>
		<script src="./js/jquery-1.8.2.js">
		</script>
		<link rel="stylesheet" type="text/css" href="./css/osa.css">
		<script>
			function handleKey(e) {
				if (e.keyCode == 13) {
					doLogin();
					return false;
				}
			}
			function doLogin(){
				params="userName=" + encodeURI($("#username").val()) + "&password=" + encodeURI($("#password").val()) + "&d=" + encodeURI(dom);
				$.ajax({
					  url: "../login",  
					  dataType: 'json',
					  type:"POST",
					  data: params,
					  success: loggedIn,
					  error: displayError
					});
			}

			function loggedIn(generatedToken){
				if (loc != ""){
					window.location=loc;
				}else{
					$('#error').html("You are now connected");
					$('#error').show();
				}
			}
			function displayError(jqXHR, textStatus, errorThrown){
				eval("err =" + jqXHR.responseText);
				if (err.error.code==401){
					$('#error').html("Wrong password or username");
				}else{
					$('#error').html(err.error.message);
				}
				$('#error').show();
				//alert("An error as occursed: " + err.error.message + " (HTTP_STATUS=" + jqXHR.status + ")");
			} 

			<?
			if (isset($_REQUEST["l"])) {
				echo "var loc=\"" . base64_decode($_REQUEST["l"]) . "\";\n";
			}else{ 
				echo "var loc=\"\";\n";
			}
			if (isset($_REQUEST["d"])) {
				echo "var dom=\"" . $_REQUEST["d"] . "\";\n";
			}else{ 
				echo "var dom=\"\";\n";
			}
			?>
		</script>
	</head>
	<body>
		<div id="logo" style="padding-left:10px;">
			<img src="./images/LogoTitle.jpg" />
		</div>
		<div id="title">
			<div style="padding-left:20px;">
				Welcome, to access  <b><? if (isset($_REQUEST["l"])) echo base64_decode($_REQUEST["l"]) ?></b> please authenticate
			</div>
		</div>
		<div id="content">
			<br>
			<div id="error" class="errorMessage"></div>
			<br>
			<center>
			<form  onkeypress="return handleKey(event)">
			<table class="loginForm">
				<tr>
					<td>Username</td>
					<td><input type="text" id="username" ></td>
				</tr>
				<tr>
					<td>Password</td>
					<td><input type="password" id="password" ></td>
				</tr>
				<tr>
					<th colspan="2" ><center><input class="button_orange" type="button" value="ok" id="loginBtn"></center></th>
				</tr>
			</table>
			</form>
			</center>
		</div>
		<script>
			$('#loginBtn').click(doLogin);
			<?if (isset($_REQUEST["cause"])){
				if ($_REQUEST["cause"] == "authorization"){
					$msg="You are not authorized to access " . base64_decode($_REQUEST["l"]);
				}else{
					$msg=$_REQUEST["cause"];
				}
			?>
				$('#error').html('<?echo $msg?>');
			<?}else{?>
				$('#error').hide();
			<?}?>
			
		</script>
	</body>
</html>
